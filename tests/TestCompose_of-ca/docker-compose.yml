version : '3'
services:

# OpenFOAM Adapter
  openfoam-adapter-fluid:
    image: "${SYSTEST_REMOTE}openfoam-adapter${PRECICE_BASE}:${OPENFOAM_TAG}"
    networks:
      - precicecomm
    volumes:
      - exchange:/home/precice/Data/Exchange
      - output:/home/precice/Data/Output
    command: >
      /bin/bash -c "source /opt/openfoam4/etc/bashrc &&
      cd /home/precice/openfoam-adapter/tutorials/CHT/flow-over-plate/buoyantPimpleFoam-laplacianFoam &&
      sed -i 's|gather-scatter\"|gather-scatter\" exchange-directory=\"/home/precice/Data/Exchange/\" network=\"eth0\"|g' precice-config_serial.xml &&
      ./runFluid &&
      cp -r Fluid/ /home/precice/Data/Output/"
    container_name: openfoam-adapter-fluid

# Code_Aster Adapter
  codeaster-adapter-solid:
    image: ca_adapter
    networks:
      - precicecomm
    volumes:
      - exchange:/home/precice/Data/Exchange
      - output:/home/precice/Data/Output
    command: >
      source /Code_Aster/etc/codeaster/profile.sh
    container_name: codeaster-adapter-solid

# Tutorial
  tutorial-data:
    build:
      context: .
      dockerfile: Dockerfile.tutorial_data
    volumes:
      - output:/Output/
    container_name: tutorial-data

  networks:
    precicecomm:
  volumes:
    exchange:
    output:
